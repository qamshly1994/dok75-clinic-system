<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOK75 - Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¹Ø§Ù…</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="dashboard-container">
        <div class="sidebar">
            <div class="logo">
                <h2>DOK75</h2>
                <span>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù</span>
            </div>
            
            <div class="user-info" id="userInfo">
                <div class="name">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                <div class="role">Ù…Ø´Ø±Ù Ø¹Ø§Ù…</div>
            </div>
            
            <ul class="menu">
                <li><a href="#" class="active" onclick="loadDashboard()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="#" onclick="loadUsers()">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</a></li>
                <li><a href="#" onclick="loadClinics()">ğŸ¥ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</a></li>
                <li><a href="#" onclick="loadDepartments()">ğŸ“‹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</a></li>
                <li><a href="#" onclick="loadSpecializations()">ğŸ”¬ Ø§Ù„ØªØ®ØµØµØ§Øª</a></li>
                <li><a href="#" onclick="loadDoctors()">ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</a></li>
                <li><a href="#" onclick="loadPatients()">ğŸ‘¤ Ø§Ù„Ù…Ø±Ø¶Ù‰</a></li>
                <li><a href="#" onclick="loadAppointments()">ğŸ“… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</a></li>
                <li><a href="#" onclick="loadReports()">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a></li>
                <li><a href="#" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a></li>
            </ul>
        </div>
        
        <div class="main-content">
            <div class="header">
                <h1 id="pageTitle">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h1>
            </div>
            
            <div id="content"></div>
        </div>
    </div>
    
    <script src="/js/main.js"></script>
    <script>
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        if (!checkAuth()) {
            window.location.href = '/login.html';
        }
        
        let currentUser = null;
        
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        async function loadUserData() {
            try {
                const data = await fetchWithLoading('/api/auth/me');
                if (data.success) {
                    currentUser = data.user;
                    document.querySelector('.user-info .name').textContent = currentUser.full_name;
                    
                    if (currentUser.role !== 'super_admin') {
                        window.location.href = '/dashboard.html';
                    }
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£:', error);
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        async function loadUsers() {
            document.getElementById('pageTitle').textContent = 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†';
            
            try {
                const data = await fetchWithLoading('/api/users');
                
                let html = `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
                            <button class="btn btn-primary" onclick="showAddUser()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</button>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                                        <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                        <th>Ø§Ù„Ø¯ÙˆØ±</th>
                                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                if (data.users) {
                    data.users.forEach(user => {
                        html += `
                            <tr>
                                <td>${user.full_name}</td>
                                <td>${user.username}</td>
                                <td>${
                                    user.role === 'super_admin' ? 'Ù…Ø´Ø±Ù Ø¹Ø§Ù…' :
                                    user.role === 'doctor' ? 'Ø·Ø¨ÙŠØ¨' : 'Ù…ÙˆØ¸Ù Ø§Ø³ØªÙ‚Ø¨Ø§Ù„'
                                }</td>
                                <td><span class="badge ${user.is_active ? 'badge-success' : 'badge-danger'}">${user.is_active ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·'}</span></td>
                                <td>
                                    <button class="action-btn edit-btn" onclick="toggleUserStatus(${user.id})">ğŸ”„ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©</button>
                                    <button class="action-btn delete-btn" onclick="deleteUser(${user.id})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                                </td>
                            </tr>
                        `;
                    });
                }
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                document.getElementById('content').innerHTML = html;
            } catch (error) {
                console.error('Ø®Ø·Ø£:', error);
            }
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…
        async function showAddUser() {
            const username = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:');
            if (!username) return;
            
            const password = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:');
            if (!password) return;
            
            const full_name = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:');
            if (!full_name) return;
            
            const role = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¯ÙˆØ± (super_admin/doctor/receptionist):');
            
            try {
                const data = await fetchWithLoading('/api/users', {
                    method: 'POST',
                    body: JSON.stringify({ username, password, full_name, role })
                });
                
                if (data.success) {
                    alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                    loadUsers();
                } else {
                    alert('âŒ Ø®Ø·Ø£: ' + data.error);
                }
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
            }
        }
        
        // ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        async function toggleUserStatus(userId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) return;
            
            try {
                const data = await fetchWithLoading(`/api/users/${userId}/toggle-status`, {
                    method: 'PATCH'
                });
                
                if (data.success) {
                    alert(data.message);
                    loadUsers();
                }
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£');
            }
        }
        
        // Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…
        async function deleteUser(userId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) return;
            
            try {
                const data = await fetchWithLoading(`/api/users/${userId}`, {
                    method: 'DELETE'
                });
                
                if (data.success) {
                    alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                    loadUsers();
                }
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£');
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª
        async function loadClinics() {
            document.getElementById('pageTitle').textContent = 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª';
            
            try {
                const data = await fetchWithLoading('/api/clinics');
                
                let html = `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</h2>
                            <button class="btn btn-primary" onclick="showAddClinic()">+ Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠØ§Ø¯Ø©</button>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                                        <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                        <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                if (data.clinics) {
                    data.clinics.forEach(clinic => {
                        html += `
                            <tr>
                                <td>${clinic.name}</td>
                                <td>${clinic.phone || '-'}</td>
                                <td>${clinic.address || '-'}</td>
                                <td><span class="badge ${clinic.is_active ? 'badge-success' : 'badge-danger'}">${clinic.is_active ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·'}</span></td>
                                <td>
                                    <button class="action-btn edit-btn" onclick="toggleClinicStatus(${clinic.id})">ğŸ”„ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©</button>
                                </td>
                            </tr>
                        `;
                    });
                }
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                document.getElementById('content').innerHTML = html;
            } catch (error) {
                console.error('Ø®Ø·Ø£:', error);
            }
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠØ§Ø¯Ø©
        async function showAddClinic() {
            const name = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©:');
            if (!name) return;
            
            const phone = prompt('Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:');
            const address = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:');
            
            try {
                const data = await fetchWithLoading('/api/clinics', {
                    method: 'POST',
                    body: JSON.stringify({ name, phone, address })
                });
                
                if (data.success) {
                    alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
                    loadClinics();
                }
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£');
            }
        }
        
        // ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©
        async function toggleClinicStatus(clinicId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©ØŸ')) return;
            
            try {
                const data = await fetchWithLoading(`/api/clinics/${clinicId}/toggle-status`, {
                    method: 'PATCH'
                });
                
                if (data.success) {
                    alert(data.message);
                    loadClinics();
                }
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£');
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        async function loadDepartments() {
            document.getElementById('pageTitle').textContent = 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…';
            // Ù…Ø´Ø§Ø¨Ù‡ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª
        async function loadSpecializations() {
            document.getElementById('pageTitle').textContent = 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®ØµØµØ§Øª';
            // Ù…Ø´Ø§Ø¨Ù‡ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡
        async function loadDoctors() {
            document.getElementById('pageTitle').textContent = 'Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡';
            // Ù…Ø´Ø§Ø¨Ù‡ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø±Ø¶Ù‰
        async function loadPatients() {
            document.getElementById('pageTitle').textContent = 'Ø§Ù„Ù…Ø±Ø¶Ù‰';
            // Ù…Ø´Ø§Ø¨Ù‡ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
        async function loadAppointments() {
            document.getElementById('pageTitle').textContent = 'Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯';
            // Ù…Ø´Ø§Ø¨Ù‡ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
        function loadReports() {
            document.getElementById('pageTitle').textContent = 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±';
            document.getElementById('content').innerHTML = '<p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
        }
        
        // Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function loadDashboard() {
            document.getElementById('pageTitle').textContent = 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©';
            document.getElementById('content').innerHTML = `
                <div class="welcome-message">
                    <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¹Ø§Ù…</h2>
                    <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ù† Ù‡Ù†Ø§</p>
                </div>
            `;
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        loadUserData();
        loadDashboard();
    </script>
</body>
</html>
