<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOK75 - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 280px;
            background: linear-gradient(135deg, #006D77 0%, #2C3E50 100%);
            color: white;
            padding: 30px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar .logo {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .sidebar .logo h2 {
            font-size: 36px;
            font-weight: 900;
            margin: 0;
        }
        
        .sidebar .logo p {
            font-size: 14px;
            opacity: 0.8;
            margin: 5px 0 0;
        }
        
        .sidebar .user-info {
            text-align: center;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        
        .sidebar .user-info .name {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .sidebar .user-info .role {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .sidebar .menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .sidebar .menu li {
            margin-bottom: 5px;
        }
        
        .sidebar .menu a {
            display: block;
            padding: 15px 25px;
            color: white;
            text-decoration: none;
            font-size: 16px;
            transition: all 0.3s;
            border-right: 4px solid transparent;
        }
        
        .sidebar .menu a:hover,
        .sidebar .menu a.active {
            background: rgba(255,255,255,0.1);
            border-right-color: white;
        }
        
        .sidebar .menu i {
            margin-left: 10px;
            width: 24px;
            display: inline-block;
        }
        
        .main-content {
            flex: 1;
            margin-right: 280px;
            padding: 30px;
            background: #f5f5f5;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 28px;
            color: #2C3E50;
            margin: 0;
        }
        
        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Tajawal', sans-serif;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-card .icon {
            font-size: 40px;
            margin-bottom: 15px;
        }
        
        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
            color: #2C3E50;
        }
        
        .stat-card .label {
            font-size: 16px;
            color: #666;
        }
        
        .section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-header h2 {
            font-size: 20px;
            color: #2C3E50;
            margin: 0;
        }
        
        .btn-add {
            background: linear-gradient(135deg, #006D77 0%, #2C3E50 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Tajawal', sans-serif;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .appointment-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .appointment-item:last-child {
            border-bottom: none;
        }
        
        .appointment-time {
            background: #f0f0f0;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            color: #2C3E50;
            margin-left: 20px;
            min-width: 80px;
        }
        
        .appointment-info {
            flex: 1;
        }
        
        .appointment-info h4 {
            margin: 0 0 5px;
            color: #2C3E50;
        }
        
        .appointment-info p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-confirmed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-completed {
            background: #cce5ff;
            color: #004085;
        }
        
        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .main-content {
                margin-right: 0;
            }
            
            .dashboard-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
        <div class="sidebar">
            <div class="logo">
                <h2>DOK75</h2>
                <p>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</p>
            </div>
            
            <div class="user-info" id="userInfo">
                <div class="name">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                <div class="role"></div>
            </div>
            
            <ul class="menu">
                <li><a href="#" class="active" onclick="loadDashboard()"><i>ğŸ </i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="#" onclick="loadAppointments()"><i>ğŸ“…</i> Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</a></li>
                <li><a href="#" onclick="loadPatients()"><i>ğŸ‘¥</i> Ø§Ù„Ù…Ø±Ø¶Ù‰</a></li>
                <li><a href="#" onclick="loadDoctors()"><i>ğŸ‘¨â€âš•ï¸</i> Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</a></li>
                <li><a href="#" onclick="loadClinics()"><i>ğŸ¥</i> Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</a></li>
                <li><a href="#" onclick="loadDepartments()"><i>ğŸ“‹</i> Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</a></li>
                <li><a href="#" onclick="loadReports()"><i>ğŸ“Š</i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a></li>
                <li><a href="#" onclick="loadSettings()"><i>âš™ï¸</i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a></li>
            </ul>
        </div>
        
        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="main-content">
            <div class="header">
                <h1 id="pageTitle">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h1>
                <button class="logout-btn" onclick="logout()">
                    <span>ğŸšª</span> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                </button>
            </div>
            
            <div id="content">
                <!-- Ù‡Ù†Ø§ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                <div class="stats-grid" id="statsGrid"></div>
                
                <div class="section">
                    <div class="section-header">
                        <h2>Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…</h2>
                        <button class="btn-add" onclick="showAddAppointment()">
                            <span>+</span> Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯
                        </button>
                    </div>
                    <div id="todayAppointments"></div>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <h2>Ø¢Ø®Ø± Ø§Ù„Ù…Ø±Ø¶Ù‰</h2>
                        <button class="btn-add" onclick="showAddPatient()">
                            <span>+</span> Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙŠØ¶
                        </button>
                    </div>
                    <div id="recentPatients"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªÙˆÙƒÙ†
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = '/login.html';
        }
        
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        let currentUser = null;
        
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        async function loadUserData() {
            try {
                const res = await fetch('/api/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await res.json();
                if (data.success) {
                    currentUser = data.user;
                    updateUserInfo();
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
        function updateUserInfo() {
            const userInfo = document.getElementById('userInfo');
            if (currentUser) {
                userInfo.innerHTML = `
                    <div class="name">${currentUser.full_name}</div>
                    <div class="role">${
                        currentUser.role === 'super_admin' ? 'Ù…Ø´Ø±Ù Ø¹Ø§Ù…' :
                        currentUser.role === 'doctor' ? 'Ø·Ø¨ÙŠØ¨' : 'Ù…ÙˆØ¸Ù Ø§Ø³ØªÙ‚Ø¨Ø§Ù„'
                    }</div>
                `;
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        async function loadDashboard() {
            document.getElementById('pageTitle').textContent = 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©';
            
            try {
                // Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…
                const today = new Date().toISOString().split('T')[0];
                const appointmentsRes = await fetch(`/api/appointments/date/${today}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const appointmentsData = await appointmentsRes.json();
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                const statsGrid = document.getElementById('statsGrid');
                statsGrid.innerHTML = `
                    <div class="stat-card">
                        <div class="icon">ğŸ“…</div>
                        <div class="value">${appointmentsData.count || 0}</div>
                        <div class="label">Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">ğŸ‘¥</div>
                        <div class="value">0</div>
                        <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶Ù‰</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">ğŸ‘¨â€âš•ï¸</div>
                        <div class="value">0</div>
                        <div class="label">Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">âœ…</div>
                        <div class="value">0</div>
                        <div class="label">Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…ÙƒØªÙ…Ù„Ø©</div>
                    </div>
                `;
                
                // Ø¹Ø±Ø¶ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…
                const appointmentsDiv = document.getElementById('todayAppointments');
                if (appointmentsData.appointments?.length > 0) {
                    appointmentsDiv.innerHTML = appointmentsData.appointments.map(app => `
                        <div class="appointment-item">
                            <div class="appointment-time">
                                ${new Date(app.appointment_date).toLocaleTimeString('ar-SA')}
                            </div>
                            <div class="appointment-info">
                                <h4>${app.patient?.full_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</h4>
                                <p>${app.doctor?.full_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                            </div>
                            <div class="status-badge status-${app.status}">
                                ${app.status === 'pending' ? 'Ù…Ø¹Ù„Ù‚' :
                                  app.status === 'confirmed' ? 'Ù…Ø¤ÙƒØ¯' :
                                  app.status === 'completed' ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù…Ù„ØºÙŠ'}
                            </div>
                        </div>
                    `).join('');
                } else {
                    appointmentsDiv.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…</p>';
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            }
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/login.html';
        }
        
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ†Ù‚Ù„ (Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ°Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
        function loadAppointments() {
            document.getElementById('pageTitle').textContent = 'Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯';
            document.getElementById('content').innerHTML = '<p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
        }
        
        function loadPatients() {
            document.getElementById('pageTitle').textContent = 'Ø§Ù„Ù…Ø±Ø¶Ù‰';
            document.getElementById('content').innerHTML = '<p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±Ø¶Ù‰
        }
        
        function loadDoctors() {
            document.getElementById('pageTitle').textContent = 'Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡';
            document.getElementById('content').innerHTML = '<p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡
        }
        
        function loadClinics() {
            document.getElementById('pageTitle').textContent = 'Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª';
            document.getElementById('content').innerHTML = '<p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª
        }
        
        function loadDepartments() {
            document.getElementById('pageTitle').textContent = 'Ø§Ù„Ø£Ù‚Ø³Ø§Ù…';
            document.getElementById('content').innerHTML = '<p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        }
        
        function loadReports() {
            document.getElementById('pageTitle').textContent = 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±';
            document.getElementById('content').innerHTML = '<p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
        }
        
        function loadSettings() {
            document.getElementById('pageTitle').textContent = 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª';
            document.getElementById('content').innerHTML = '<p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        }
        
        function showAddAppointment() {
            alert('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯');
        }
        
        function showAddPatient() {
            alert('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙŠØ¶');
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        loadUserData();
        loadDashboard();
    </script>
</body>
</html>
